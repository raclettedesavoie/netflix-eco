(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{644:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(5155),l=s(2115),a=s(9911);function i(e){let{query:t,setQuery:s,onSearch:l,loadingSearch:i,onGoHome:n}=e;return(0,r.jsxs)("header",{className:"flex items-center justify-between p-6 bg-white shadow mb-8 gap-4",children:[(0,r.jsx)("button",{onClick:n,"aria-label":"Accueil",className:"cursor-pointer text-2xl text-blue-600 hover:text-blue-800",children:(0,r.jsx)(a.rQ8,{})}),(0,r.jsxs)("div",{className:"flex flex-grow gap-2 max-w-lg",children:[(0,r.jsx)("input",{type:"text",placeholder:"Nom de la s\xe9rie/film ...",value:t,onChange:e=>s(e.target.value),onKeyDown:e=>{"Enter"===e.key&&l()},className:"flex-grow p-3 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"}),(0,r.jsx)("button",{onClick:l,disabled:i||!t.trim(),className:"cursor-pointer px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Recherche...":"Rechercher"})]})]})}var n=s(760),o=s(6408);function c(e){let{isOpen:t,onClose:s,title:a,children:i}=e,c=(0,l.useRef)(null);return((0,l.useEffect)(()=>{function e(e){t&&c.current&&!c.current.contains(e.target)&&s()}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[t,s]),t)?(0,r.jsx)(n.N,{children:t&&(0,r.jsxs)(o.P.div,{ref:c,initial:{opacity:0,y:-20},animate:{opacity:1,y:16},exit:{opacity:0,y:-20},transition:{duration:.3},className:"absolute top-full left-1/2 translate-x-[-50%] mt-4 bg-white border shadow-lg rounded p-4 w-80 z-50",onClick:e=>e.stopPropagation(),layout:!0,children:[(0,r.jsx)("button",{onClick:s,className:"absolute top-2 right-2 text-gray-700 hover:text-gray-900 font-bold text-xl cursor-pointer","aria-label":"Close modal",children:"\xd7"}),a&&(0,r.jsx)("h3",{className:"text-lg font-semibold mb-2",children:a}),(0,r.jsx)("div",{children:i})]})}):null}function u(e){let{serie:t,mySeries:s,setMySeries:l,selectedSerie:i,onSelect:n}=e,o=e=>n(e),u=s.some(e=>e.id===t.id),d=()=>{var e;return(null==(e=t.next_episode_to_air)?void 0:e.air_date)?new Date(t.next_episode_to_air.air_date).toLocaleDateString():"Aucune date disponible"},p=()=>{l(e=>e.filter(e=>e.id!==t.id))},h=()=>{u||l(e=>[...e,t])};return(0,r.jsxs)("li",{className:"w-[254px] relative",children:[(0,r.jsx)("div",{className:"cursor-pointer w-64 hover:shadow-lg rounded overflow-hidden border relative overflow-visible ",children:(0,r.jsxs)("button",{type:"button",onClick:()=>{o(t),console.log(i)},className:"w-full text-left cursor-pointer overflow-hidden ",children:[t.poster_path?(0,r.jsx)("img",{src:"".concat("https://image.tmdb.org/t/p/w500").concat(t.poster_path),alt:"Affiche ".concat(t.name),className:"w-[254px] h-[381px]"}):(0,r.jsx)("div",{className:"w-full h-40 bg-gray-300 flex items-center justify-center text-gray-500 text-xs w-[254px] h-[381px]",children:"Pas dâ€™image"}),(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("h3",{className:"font-semibold truncate ",children:t.name}),(0,r.jsx)("span",{className:"text-gray-500 text-sm truncate",children:t.first_air_date})]}),"tv"==t.type?(0,r.jsxs)("p",{className:"relative",children:["Prochaine saison pr\xe9vue le\xa0",(0,r.jsx)("strong",{children:d()}),u?(0,r.jsx)(a.Mbv,{className:"text-red-500 cursor-pointer hover:scale-110 transition-transform absolute top-[5px] right-[5px]",title:"Retirer de mes s\xe9ries",onClick:e=>{e.stopPropagation(),p()}}):(0,r.jsx)(a.sOK,{className:"text-gray-400 cursor-pointer hover:text-red-500 hover:scale-110 transition-transform absolute top-[5px] right-[5px]",title:"Ajouter \xe0 mes s\xe9ries",onClick:e=>{e.stopPropagation(),h()}})]}):(0,r.jsxs)("span",{children:["Prochain film pr\xe9vue le\xa0",(0,r.jsx)("strong",{children:d()})]})]})]})}),i&&i.id==t.id&&(0,r.jsxs)(c,{isOpen:!!i,onClose:()=>n(null),title:i.name,children:[(0,r.jsxs)("p",{children:["Langue : ",i.original_language]}),(0,r.jsx)("p",{children:i.overview})]})]},t.id)}function d(e){let{results:t,serieDetails:s,mySeries:a,setMySeries:i}=e,[n,o]=(0,l.useState)(null),c=t.map(e=>{var t;let r=null==s?void 0:s.find(t=>t.id===e.id);return{id:e.id,name:e.name,first_air_date:e.first_air_date,poster_path:e.poster_path,next_episode_to_air:null!=(t=null==r?void 0:r.next_episode_to_air)?t:null,overview:e.overview,original_language:e.original_language,type:e.type}});return console.log("serie-results",c),(0,r.jsx)(r.Fragment,{children:c.length>0&&(0,r.jsx)("ul",{className:"flex flex-wrap justify-center gap-6 p-4 w-full",children:c.map(e=>(0,r.jsx)(u,{serie:e,mySeries:a,setMySeries:i,selectedSerie:n,onSelect:o},e.id))})})}function p(e){let{mySeries:t,setMySeries:s}=e,[a,i]=(0,l.useState)(null);return console.log("mySeries",t),(0,r.jsx)(r.Fragment,{children:t.length>0&&(0,r.jsx)("ul",{className:"flex flex-wrap justify-center gap-6 p-4 w-full",children:t.map(e=>(0,r.jsx)(u,{serie:e,mySeries:t,setMySeries:s,selectedSerie:a,onSelect:i},e.id))})})}function h(){let[e,t]=(0,l.useState)(""),[s,a]=(0,l.useState)([]),[n,o]=(0,l.useState)(null),[c,u]=(0,l.useState)(!1),[h,m]=(0,l.useState)(null),[x,f]=(0,l.useState)([]),[g,v]=(0,l.useState)("mySeries"),y=async()=>{try{var t,s;u(!0),m(null),o(null),a([]);let[r,l]=await Promise.all([fetch("https://localhost:7238/api/Movie/search?query=".concat(encodeURIComponent(e),"&type=tv")),fetch("https://localhost:7238/api/Movie/search?query=".concat(encodeURIComponent(e),"&type=movie"))]);if(!r.ok||!l.ok)throw Error("Erreur lors de la recherche");let i=await r.json(),n=await l.json(),c=[...(null!=(t=i.results)?t:[]).map(e=>({...e,type:"tv"})),...(null!=(s=n.results)?s:[]).map(e=>({...e,type:"movie",name:e.title,first_air_date:e.release_date}))].sort((t,s)=>{var r,l;let a=e.trim().toLowerCase(),i=+((null==(r=t.name)?void 0:r.toLowerCase())===a),n=+((null==(l=s.name)?void 0:l.toLowerCase())===a);return i!==n?n-i:s.popularity-t.popularity}).slice(0,3);a(c),console.log(c);let d=await Promise.all(c.map(async e=>{let t=await fetch("https://localhost:7238/api/Movie/details/".concat(e.id,"?type=").concat(e.type));if(!t.ok)throw Error("Erreur lors de la r\xe9cup\xe9ration des d\xe9tails pour id=".concat(e.id));return await t.json()}));o(d),console.log(d),v("searchResults")}catch(e){m(e.message)}finally{u(!1)}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i,{query:e,setQuery:t,onSearch:y,loadingSearch:c,onGoHome:()=>{v("mySeries"),a([]),o(null),m(null),t("")}}),(0,r.jsxs)("div",{className:"w-full px-8 flex flex-col md:flex-row gap-8",children:["searchResults"===g&&(0,r.jsxs)("main",{className:"flex-grow",children:[h&&(0,r.jsx)("p",{className:"text-red-500 mb-4",children:h}),(0,r.jsx)(d,{results:s,serieDetails:n,mySeries:x,setMySeries:f})]}),"mySeries"===g&&(0,r.jsx)(p,{mySeries:x,setMySeries:f})]})]})}},2152:(e,t,s)=>{Promise.resolve().then(s.bind(s,644))}},e=>{var t=t=>e(e.s=t);e.O(0,[711,862,441,684,358],()=>t(2152)),_N_E=e.O()}]);